---
title: "Primer Parcial (30pts). Solución"
subtitle: "Programacion Estadística I"
author: "Lic. Alvaro Chirino Gutierrez"
date: "10/6/2020"
output: html_document
runtime: shiny
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Pregunta 1 (5pts).
  * (1pt) ¿Qué libreria en R permite definir el diseño muestral de una encuesta por muestreo?
  
**Resp.** Libreria survey
  
  * (1pt) ¿Qué diferencia existe entre un dataframe y una matriz en R? 
  
**Resp.** Una matriz es un objeto homogeneo mientras que un dataframe es uno heterogeneo 

  * (2pt) Se realizó una prueba de independencia chi-cuadrado entre el sexo y el partido pólitico de interés en EEUU. El resultado del comando chisq.test en R es el siguiente:
  
```{r,echo=FALSE}
library(knitr)
M <- as.table(rbind(c(762, 327, 468), c(484, 239, 477)))
dimnames(M) <- list(sexo = c("F", "M"),
                    partido = c("Democrata","Independiente", "Republicano"))
kable(M,format = "latex")
(Xsq <- chisq.test(M))  # Prints test summary
```
 ¿Qué puede concluir acerca de la independencia o no del sexo y el partido politico?, justifique su respuesta.

**Resp.** Dado el valor del p-valor se rechaza la hipotesis nula de independencia, podemos concluir que el sexo y el partido político no son independientes.
  
  * (1pt) Mencione en forma resumida los pasos para la recopilación de información en el scraping web.

**Resp.** Los pasos se resumen en:

  1. Identificar la información que se necesita
  2. Averiguar si existe esa información en la web
  3. Evalue la calidad de la información 
  4. Identificar ventajas y desventajas de realizar la recolección mediante scraping
  5. Decidir la fuente más adecuada, pueden ser uno o más 
  

## Pregunta 2 (5 pts)

Escribir el código en R para los siguientes casos:

  * (1pt) $\sum_{i=10}^{40}{\left(\frac{2^i}{i}+\frac{3^i}{i^2} \right)}$
  
**Resp.**

```{r}
i<-10:40
sum((2^i)/i+(3^i)/(i^2))
```

  * (1pt) Crear una matriz de $4*5$ que contengan valores aleatorios de una uniforme con $a=0, b=10$
  
**Resp.**

```{r}
matrix(runif(20,0,10),nrow=4)
```  

  * (1pt) Calcular $\sum_{i=1}^{20}{\sum_{j=2}^5{\frac{i^3}{2+ij}}}$
  
**Resp.**

```{r}
s<-0
for(i in 1:20){
  for(j in 2:5){
    s<-s+(i^3)/(2+i*j)
  }
}
s  
```
  
  * (2pts) Crear una función que dado un vector numérico devuelva el coeficiente de variación y el coeficiente de asimetría de Pearson y Fisher.

**Resp.**

```{r}
fx<-function(x){
  n<-length(x)
  cv<-sd(x)/mean(x)
  #pearson
  p<-(3*(mean(x)-median(x)))/sd(x)
  #fisher
  f<-(sum((x-mean(x))^3)/(n-1))/sd(x)^3
  return(c(cv,p,f))
}
x<-rnorm(1000)
fx(x)
```

## Pregunta 3 (10 pts) 
Usando la información de www.worldometers.com sobre el COVID con la libreria rvest, generar en un documento R markdown.

  * Una tabla que muestre los 10 países con más altos contagios por millón

**Resp.**

```{r}
library(rvest)
covid<-read_html("https://www.worldometers.info/coronavirus/")
aux<-html_table(covid)
t<-aux[[1]]
names(t)[1]<-"id"
t<-t[!is.na(t$id),]
names(t)[11]<-"casoM"
names(t)[14]<-"testM"
t$casoM<-as.numeric(gsub(",","",t$casoM))
t$testM<-as.numeric(gsub(",","",t$testM))
tt<-t[order(t$casoM,decreasing = T),c(2,11)][1:10,]
knitr::kable(tt,caption = "Top 10 casos por Millon por país")
```

  * Un gráfico de los casos por millón ($X$) versus los test por millón ($Y$), incluir en el gráfico los nombres de los países.
  
```{r}
plot(t$casoM,t$testM,type="n",axes=F,ann=F)
text(t$casoM,t$testM,t$`Country,Other`,cex=0.6)
axis(1)
axis(2)
title(xlab="Casos por Millon",ylab="Test por Millon")
```

## Pregunta 4 (10 pts) 
Realice una función en Shiny empleando la base de datos electoral del $20o$ que permita ver los resultados por municipio de las elecciones presidenciales, la aplicación debe permitir seleccionar el departamento y también el municipio de interés y ver los resultados en una tabla y un gráfico a elección. 

```{r}
#Preparando la base de datos
load(url("https://github.com/AlvaroLimber/EST-383/raw/master/data/oct20.RData"))
computo<-computo[computo$País=="Bolivia" & computo$Elección=="Presidente y Vicepresidente",]
mun<-aggregate(computo[,13:25],by=computo[,c(3,5,6)],sum)
ldep<-names(table(mun$Departamento))
lmun<-list()
for(i in 1:9){
lmun[[i]]<-names(table(mun$Municipio[mun$Departamento==ldep[i]]))  
}

```


```{r, echo=T}
inputPanel(
  selectInput("dep", label = "Departamento:",
              choices = ldep, selected = 1),
  conditionalPanel(
  condition = "input.dep == 'Beni'",
  selectInput("depm", label="Municipio",choices = lmun[[1]])
  ),
  conditionalPanel(
  condition = "input.dep == 'Chuquisaca'",
  selectInput("depm", label="Municipio",choices = lmun[[2]])
  ),
  conditionalPanel(
  condition = "input.dep == 'Cochabamba'",
  selectInput("depm", label="Municipio",choices = lmun[[3]])
  ),
  conditionalPanel(
  condition = "input.dep == 'La Paz'",
  selectInput("depm", label="Municipio",choices = lmun[[4]])
  ),
  conditionalPanel(
  condition = "input.dep == 'Oruro'",
  selectInput("depm", label="Municipio",choices = lmun[[5]])
  ),
  conditionalPanel(
  condition = "input.dep == 'Pando'",
  selectInput("depm", label="Municipio",choices = lmun[[6]])
  ),
  conditionalPanel(
  condition = "input.dep == 'Potosí'",
  selectInput("depm", label="Municipio",choices = lmun[[7]])
  ),
  conditionalPanel(
  condition = "input.dep == 'Santa Cruz'",
  selectInput("depm", label="Municipio",choices = lmun[[8]])
  ),
  conditionalPanel(
  condition = "input.dep == 'Tarija'",
  selectInput("depm", label="Municipio",choices = lmun[[9]])
  )
)
renderTable({
  mun[mun$Departamento==input$dep & mun$Municipio==input$depm,]
})
renderPlot({
  bb<-mun[mun$Departamento==input$dep & mun$Municipio==input$depm,]
  bb<-data.frame(tv=rownames(t(bb[,c(5:13,15,16)])),vv=t(bb[,c(5:13,15,16)]))
  barplot(bb$X24,names.arg = bb$tv,horiz = T,las=1,cex.names = 0.6)
})
```
