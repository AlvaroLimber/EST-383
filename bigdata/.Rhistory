sc <- spark_connect(master = "local",
spark_home = "C:\\Users\\ALVARO\\AppData\\Local\\spark", version = "2.3.5")
spark_disconnect(sc)
Sys.getenv("SPARK_HOME_VERSION")
Sys.getenv("C:\\Users\\ALVARO\\AppData\\Local\\spark")
Sys.getenv("C:\\Users\\ALVARO\\AppData\\Local\\spark")
#inicia la sesión
sc <- spark_connect(master = "local",
spark_home = "C:\\Users\\ALVARO\\AppData\\Local\\spark")
#inicia la sesión
sc <- spark_connect(master = "local",
spark_home = "C:\\Users\\ALVARO\\AppData\\Local\\spark", version = "3.0.0")
version <- invoke(spark_context(sc), "version")
version
sc <- spark_connect(config = "Apache Spark-ic")
spark_disconnect(sc)
sc <- spark_connect(config = "Apache Spark-ic")
spark_config()
sc <- spark_connect(master = "local",
spark_home = "C:\\Users\\ALVARO\\Downloads", version = "3.0.1")
#inicia la sesión
sc <- spark_connect(master = "local", version = "3.0.1")
#Habilitando la librería
library(sparklyr)
#inicia la sesión
sc <- spark_connect(master = "local", version = "3.0.1")
#inicia la sesión
sc <- spark_connect(master = "local", version = "3.0.0")
spark_web(sc)
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "2G"
conf$spark.memory.fraction <- 0.8
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "1.5G"
conf$spark.memory.fraction <- 0.8
#apagar conexión
spark_disconnect(sc)
#apagar conexión
spark_disconnect(sc)
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "1.5G"
conf$spark.memory.fraction <- 0.8
#inicia la sesión
sc <- spark_connect(master = "local", version = "3.0.0")
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "2G"
conf$spark.memory.fraction <- 0.8
spark_config
conf$`sparklyr.shell.driver-memory`
conf <- spark_config()
conf$`sparklyr.shell.driver-memory`
conf$`sparklyr.shell.driver-memory` <- "0.5G"
conf$spark.memory.fraction <- 0.8
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "0.5G"
conf$spark.memory.fraction <- 0.8
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "0.5G"
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "400MiB"
#apagar conexión
spark_disconnect(sc)
(sc)
#apagar conexión
spark_disconnect(sc)
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "400MiB"
#inicia la sesión
sc <- spark_connect(master = "local", version = "3.0.0")
#apagar conexión
spark_disconnect(sc)
#versiones instaladas
spark_installed_versions()
sc <- spark_connect(master = "local",
spark_home = "C:\\Users\\ALVARO\\Downloads", version = "2.4.3")
#inicia la sesión
sc <- spark_connect(master = "local", version = "2.4.3")
spark_web(sc)
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "2G"
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "2G"
#apagar conexión
spark_disconnect(sc)
#apagar conexión
spark_disconnect(sc)
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "2G"
#inicia la sesión
sc <- spark_connect(master = "local", version = "2.4.3")
matrix(rnorm(10000),1000,1000)
bd<-data.frame(matrix(rnorm(10000),1000,1000))
bd
str(bd)
sp_bd<-copy_to(bd)
sp_bd<-copy_to(sc,bd)
object.size(bd)/10^6
#apagar conexión
spark_disconnect(sc)
#inicia la sesión
sc <- spark_connect(master = "local", version = "2.4.3")
#apagar conexión
spark_disconnect(sc)
#inicia la sesión
sc <- spark_connect(master = "local", version = "3.0.1")
sc <- spark_connect(master = "local", spark_home = "C:\Users\ALVARO\AppData\Local\spark\spark-3.0.1-bin-hadoop2.7")
sc <- spark_connect(master = "local", spark_home = "C:\\Users\\ALVARO\\AppData\\Local\\spark\\spark-3.0.1-bin-hadoop2.7")
spark_home_dir()
sc <- spark_connect(master = "local", spark_home = "C:\\Users\\ALVARO\\AppData\\Local\\spark",version="3.0.1")
#Habilitando la librería
library(sparklyr)
sc <- spark_connect(master = "local", spark_home = "C:\\Users\\ALVARO\\AppData\\Local\\spark",version="3.0.1")
install.packages("dplyr")
install.packages("dplyr")
library(dplyr)
load(url("https://github.com/AlvaroLimber/EST-384/raw/master/data/eh19.RData"))
load(eh19p[,1:20])
head(eh19p[,1:20])
eh19p$aestudio
## Obtener el promedio de edad por sexo de los jefes de hogar
eh19p[eh19p$s02a_05=="1.JEFE O JEFA DEL HOGAR",c("s02a_03","s02a_02")]
## Obtener el promedio de edad por sexo de los jefes de hogar
aux<-eh19p[eh19p$s02a_05=="1.JEFE O JEFA DEL HOGAR",c("s02a_03","s02a_02")]
tapply(aux$s02a_03, aux$s02a02, mean)
tapply(aux$s02a_03, aux$s02a_02, mean)
?subset()
subset(eh19p,s02a_05=="1.JEFE O JEFA DEL HOGAR")
subset(eh19p,s02a_05=="1.JEFE O JEFA DEL HOGAR",c("s02a_03","s02a_02"))
subset(eh19p,s02a_05=="1.JEFE O JEFA DEL HOGAR",c("s02a_03","s02a_02"))
#dplyr
# %>% operador pipe
eh19p %>% filter(s02a_05=="1.JEFE O JEFA DEL HOGAR") %>% group_by(s02a_02)
#dplyr
# %>% operador pipe
eh19p %>% filter(s02a_05=="1.JEFE O JEFA DEL HOGAR") %>% group_by(s02a_02) %>%
summarise(mean(s02a_03))
#dplyr
# %>% operador pipe
t1<-eh19p %>% filter(s02a_05=="1.JEFE O JEFA DEL HOGAR") %>% group_by(s02a_02) %>%
summarise(mean(s02a_03))
class(t1)
?rename
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(s02a_05=="1.JEFE O JEFA DEL HOGAR") %>% group_by(s02a_02) %>%
summarise(mean(s02a_03))
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(s02a_02) %>%
summarise(mean(s02a_03))
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(mean(edad))
t1
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad))
t2<-eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad))
t
t1
t2
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),mean(aestudio))
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),mean(aestudio,na.rm = T))
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T))
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),median(aestudio,na.rm = T))
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T))
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T),count())
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T),tail())
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T),n())
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T),n=n())
## Obtener el promedio de edad y años de educación por sexo de los jefes de hogar
t3<-eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T),n=n())
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T),n=n())
names(eh19p)
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(depto,area,sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T),n=n())
eh19p %>% rename(sexo=s02a_02,edad=s02a_03,paren=s02a_05) %>%  filter(paren=="1.JEFE O JEFA DEL HOGAR") %>% group_by(depto,area,sexo) %>%
summarise(edad=mean(edad),aestudio=mean(aestudio,na.rm = T),med_aestudio=median(aestudio,na.rm = T),n=n())
eh19p$s02a_05=="1.JEFE O JEFA DEL HOGAR"
# ctr+mayus+m %>%
eh19p %>% mutate(jefe=(s02a_05=="1.JEFE O JEFA DEL HOGAR"))
names(eh19p)
# ctr+mayus+m %>%
eh19p<-eh19p %>% mutate(jefe=(s02a_05=="1.JEFE O JEFA DEL HOGAR"))
names(eh19p)
eh19p %>% mutate(jefe=(s02a_05=="1.JEFE O JEFA DEL HOGAR")) %>% group_by(jefe) %>% summarise(mean(ylab,na.rm = T))
eh19p %>% mutate(jefe=(s02a_05=="1.JEFE O JEFA DEL HOGAR")) %>% group_by(jefe,s02a_02) %>% summarise(mean(ylab,na.rm = T))
eh19p<-eh19p %>% rename(sexo=s02a_02)
names(eh19p)
names(eh19p)
names(eh19p)[6]
names(eh19p)[6]<-"edad"
names(ej19o)
names(eh19o)
names(eh19p)
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(mean(tothrs),mean(aestudio),min(ylab),max(ylab))
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(mean(tothrs,na.rm = T),mean(aestudio,na.rm = T),min(ylab,na.rm = T),max(ylab,na.rm = T))
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(horas=mean(tothrs,na.rm = T),edu=mean(aestudio,na.rm = T),min_ylab=min(ylab,na.rm = T),max_ylab=max(ylab,na.rm = T))
?range()
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(horas=mean(tothrs,na.rm = T),edu=mean(aestudio,na.rm = T),min_ylab=min(ylab,na.rm = T),max_ylab=max(ylab,na.rm = T),range(ylab))
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(horas=mean(tothrs,na.rm = T),edu=mean(aestudio,na.rm = T),min_ylab=min(ylab,na.rm = T),max_ylab=max(ylab,na.rm = T),range(ylab,na.rm=T))
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(horas=mean(tothrs,na.rm = T),edu=mean(aestudio,na.rm = T),min_ylab=min(ylab,na.rm = T),max_ylab=max(ylab,na.rm = T),range(ylab,na.rm=T))
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(horas=mean(tothrs,na.rm = T),edu=mean(aestudio,na.rm = T),min_ylab=min(ylab,na.rm = T),max_ylab=max(ylab,na.rm = T),rango=range(ylab,na.rm=T))
range(1:100)
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(horas=mean(tothrs,na.rm = T),edu=mean(aestudio,na.rm = T),min_ylab=min(ylab,na.rm = T),max_ylab=max(ylab,na.rm = T))
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(horas=mean(tothrs,na.rm = T),edu=mean(aestudio,na.rm = T),min_ylab=min(ylab,na.rm = T),max_ylab=max(ylab,na.rm = T))
# personas entre 15 y 30 años, por departamento y sexo, el promedio de horas a la semana de trabajo, años de educación y el mínimo y máximo de ingresos laborales y su rango
eh19p %>% filter(edad>=15 & edad<=30) %>% group_by(depto,sexo) %>% summarise(horas=mean(tothrs,na.rm = T),edu=mean(aestudio,na.rm = T),min_ylab=min(ylab,na.rm = T),max_ylab=max(ylab,na.rm = T)) %>% mutate(rango=max_ylab-min_ylab)
eh19p %>% arrange(1:20)
?arrange
eh19p %>% slice_sample(n=20)
eh19p %>% slice_sample(n=20) %>% select(edad)
?cut
eh19p %>% slice_sample(n=20) %>% select(edad) %>% mutate(gedad=cut(edad,c(14,25,60)))
eh19p %>% slice_sample(n=20) %>% select(edad) %>% mutate(gedad=cut(edad,c(min(edad),14,25,60,max(edad))))
eh19p %>% slice_sample(n=20) %>% select(edad) %>% mutate(gedad=cut(edad,c(0,14,25,60,max(edad))))
eh19p %>% slice_sample(n=20) %>% select(edad) %>% mutate(gedad=cut(edad,c(0,14,25,60,100)))
eh19p %>% slice_sample(n=20) %>% select(edad) %>% mutate(gedad=cut(edad,c(0,14,25,60,100),include.lowest =T))
eh19p %>% mutate(gedad=cut(edad,c(0,14,25,60,100),include.lowest =T)) %>% group_by(gedad) %>% summarise(mean(aestudio))
eh19p %>% mutate(gedad=cut(edad,c(0,14,25,60,100),include.lowest =T)) %>% group_by(gedad) %>% summarise(mean(aestudio),na.rm=T)
eh19p %>% mutate(gedad=cut(edad,c(0,14,25,60,100),include.lowest =T)) %>% group_by(gedad) %>% summarise(mean(aestudio,na.rm=T))
eh19p %>% mutate(gedad=cut(edad,c(0,5,14,25,60,100),include.lowest =T)) %>% group_by(gedad) %>% summarise(mean(aestudio,na.rm=T))
#install.packages("dplyr")
library(dplyr)
load(url("https://github.com/AlvaroLimber/EST-384/raw/master/data/eh19.RData"))
# ctr+mayus+m %>%
eh19p<-eh19p %>% mutate(jefe=(s02a_05=="1.JEFE O JEFA DEL HOGAR"))
head(eh19p)
eh19p<-eh19p %>% rename(sexo=s02a_02)
## Por departamento, área y sexo de los jefes del hogar, mostrar el porcentaje de hogares con piso de tierra.
aux<-eh19p %>% filter(jefe==T) %>% select(folio,sexo,area,depto)
head(aux)
attributes(eh19v)
aa<-attributes(eh19v)
aa$variable.labels
eh19v$s01a_09
unique(eh19v$s01a_09)
s01a_09=="1.TIERRA"
eh19p$s01a_09=="1.TIERRA"
eh19p$s01a_09=="1.TIERRA"
eh19v$s01a_09=="1.TIERRA"
aux2<-eh19v %>% mutate(tierra=s01a_09=="1.TIERRA") %>% select(folio,tierra)
head(aux2)
?merge()
head(aux)
merge(aux,aux2)
bd<-merge(aux,aux2)
bd %>% group_by(depto,area,sexo) %>% summarise(mean(tierra))
bd %>% group_by(depto,area,sexo) %>% summarise(Piso_Tierra=mean(tierra))
bd %>% group_by(depto,area,sexo) %>% summarise(Piso_Tierra=mean(tierra)*100)
head(aux)
head(aux2)
tail(aux2)
bd %>% group_by(depto,area,sexo) %>% summarise(Piso_Tierra=mean(tierra)*100)
bd<-eh19p %>% filter(s02a_02=="2.Mujer") %>% mutate(pobreza=pext0=="Pobre extremo",mujer=s02a_05=="JEFE O JEFA DEL HOGAR" ) %>% group_by(depto,area) %>% summary(pobre=mean(pobreza)*100,mujer1=mean(mujer))
# Ejercicio. Obtener una tabla por departamento y área con la siguiente información
#  * % de hogares pobres extremos
#  * % de hogares con jefes del hogar mujeres
#  * Promedio de personas en el hogar
load(url("https://github.com/AlvaroLimber/EST-384/raw/master/data/eh19.RData"))
bd<-eh19p %>% filter(s02a_02=="2.Mujer") %>% mutate(pobreza=pext0=="Pobre extremo",mujer=s02a_05=="JEFE O JEFA DEL HOGAR" ) %>% group_by(depto,area) %>% summary(pobre=mean(pobreza)*100,mujer1=mean(mujer))
bd
bd<-eh19p %>% filter(s02a_02=="2.Mujer") %>% mutate(pobreza=pext0=="Pobre extremo",mujer=s02a_05=="JEFE O JEFA DEL HOGAR" ) %>% group_by(depto,area) %>% summary(pobre=mean(pobreza)*100,mujer1=mean(mujer))
bd
bd<-eh19p %>% filter(s02a_02=="2.Mujer") %>% mutate(pobreza=pext0=="Pobre extremo",mujer=s02a_05=="JEFE O JEFA DEL HOGAR" ) %>% group_by(depto,area) %>%  summarise(pobre=mean(pobreza)*100,mujer1=mean(mujer))
bd
eh19p %>% mutate(pobreza=pext0=="Pobre extremo",jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer"), nper=1)
eh19p %>% mutate(pobreza=pext0=="Pobre extremo",jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1)
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1)
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(sum(nper))
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper))
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),max(jefa))
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa))
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa),max(pobreza))
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa),pobreza=max(pobreza))
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa),pobreza=max(pobreza)) %>% group_by(depto,area) %>% summarise(nper=mean(nper))
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa),pobreza=max(pobreza)) %>% group_by(depto,area) %>% summarise(pobreza=mean(pobreza)*100,jefa=mean(jefa)*100,nper=mean(nper))
t1<-eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa),pobreza=max(pobreza))
t1
t1$nper
table(t1$nper)
table(t1$jefa)
table(t1$pobreza)
is.na(t1$pobreza)
table(is.na(t1$pobreza))
eh19p$s02a_02
eh19p$s02a_05
eh19p$s02a_05=="JEFE O JEFA DEL HOGAR"
table(eh19p$s02a_05=="JEFE O JEFA DEL HOGAR")
eh19p$s02a_02=="2.Mujer"
table(eh19p$s02a_05=="JEFE O JEFA DEL HOGAR")
eh19p$s02a_05
unique(eh19p$s02a_05)
eh19p$pext0=="Pobre extremo"
is.na(eh19p$pext0=="Pobre extremo")
table(is.na(eh19p$pext0=="Pobre extremo"))
eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="1.JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa),pobreza=max(pobreza)) %>% group_by(depto,area) %>% summarise(pobreza=mean(pobreza,na.rm=T)*100,jefa=mean(jefa)*100,nper=mean(nper))
t1<.eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="1.JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa),pobreza=max(pobreza))
t1<-eh19p %>% mutate(pobreza=(pext0=="Pobre extremo")*1,jefa=(s02a_05=="1.JEFE O JEFA DEL HOGAR" & s02a_02=="2.Mujer")*1, nper=1) %>% group_by(depto,area,folio) %>% summarise(nper=sum(nper),jefa=max(jefa),pobreza=max(pobreza))
t1
t1 %>% group_by(depto,area) %>% summarise(pobreza=mean(pobreza,na.rm=T)*100,jefa=mean(jefa)*100,nper=mean(nper))
t2<-t1 %>% group_by(depto,area) %>% summarise(pobreza=mean(pobreza,na.rm=T)*100,jefa=mean(jefa)*100,nper=mean(nper))
t2
xtable::xtable(t2)
knitr::kable(t2)
#Habilitando la librería
library(sparklyr)
#inicia la sesión
sc <- spark_connect(master = "local", version = "2.4.3")
#apagar conexión
spark_disconnect(sc)
60*4
240*6.86
#Habilitando la librería
library(sparklyr)
#versiones instaladas
spark_installed_versions()
#inicia la sesión
sc <- spark_connect(master = "local", version = "2.4.3")
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "2G"
#apagar conexión
spark_disconnect(sc)
conf <- spark_config()
conf$`sparklyr.shell.driver-memory` <- "2G"
#inicia la sesión
sc <- spark_connect(master = "local", version = "2.4.3")
load(url("https://github.com/AlvaroLimber/EST-384/raw/master/data/eh19.RData"))
?spark_read_csv
#csv/importaciones
sp_importaciones<-spark_read_csv(sc,
name="importaciones",
path = "C:\\Users\\ALVARO\\Desktop\\db_bolivia\\importaciones\\importaciones_csv")
###########
#esquema
###########
top_rows <- read.csv("C:\\Users\\ALVARO\\Desktop\\db_bolivia\\importaciones\\importaciones_csv\\1993.csv",sep=",", nrows = 5)
names(top_rows)
spec_with_r <- sapply(top_rows, class)
spec_with_r
spec_with_r[6]<-"factor"
spec_with_r
spec_with_r
sp_importaciones2<-spark_read_csv(sc,
name="importaciones2",
path = "C:\\Users\\ALVARO\\Desktop\\db_bolivia\\importaciones\\importaciones_csv",
columns = spec_with_r)
# memoria
object.size(sp_importaciones)
m1<-data.frame(matrix(rnorm(10^7),ncol=20))
object.size(m1)/(10^6)
head(m1)
?copy_to
sp_m1<-copy_to(sc,m1)
load("C:\\Users\\ALVARO\\Documents\\GitHub\\EST-383\\data\\oct20.RData")
object.size(computo)/10^6
sp_computo<-copy_to(sc,computo)
rm(m1)
rm(computo)
sp_eh19p<-copy_to(sc,eh19p)
sp_eh19v<-copy_to(sc,eh19v)
sp_eh19p<-copy_to(sc,eh19p)
aux<-sapply(eh19p,class)
aux
aux<-sapply(eh19v,class)
aux
sp_covid<-spark_read_csv(sc,
name="covid",
path = "C:\\Users\\ALVARO\\Desktop\\db_bolivia\\bigdata\\200614COVID19MEXICO.csv")
sp_covid2<-spark_read_csv(sc,
name="covid2",
path = "C:\\Users\\ALVARO\\Desktop\\db_bolivia\\bigdata\\201115COVID19MEXICO.csv")
library(dplyr)
db_drop_table(sc,"importaciones2")
db_drop_table(sc,"m1")
sp_importaciones
sp_importaciones %>% group_by(GESTION) %>% count()
sp_covid2 %>% count()
eh19v %>% group_by(depto) %>% count()
eh19v %>% group_by(depto) %>% count()
sp_eh19p %>% group_by(depto) %>% count()
sp_eh19v %>% group_by(depto) %>% count()
eh19v %>% group_by(depto) %>% count()
sp_eh19v %>% group_by(depto) %>% count()
spark_disconnect_all()
library(sparklyr)
library(sparklyr)
install.packages("digest")
library(sparklyr)
sc <- spark_connect(master = "local", version = "2.4.3")
library(sparklyr)
spark_disconnect_all()
sc <- spark_connect(master = "local", version = "2.4.3")
library(ggplot2)
# 2. Definir la data (importación)
sp_covid<-spark_read_csv(sc,
name="covid",
path = "C:\\Users\\ALVARO\\Desktop\\db_bolivia\\bigdata\\200614COVID19MEXICO.csv")
sp_importaciones<-spark_read_csv(sc,
name="importaciones",
path = "C:\\Users\\ALVARO\\Desktop\\db_bolivia\\importaciones\\importaciones_csv")
load(url("https://github.com/AlvaroLimber/EST-383/raw/master/data/oct20.RData"))
computo$Elección
pvbol<-computo %>% filter(Elección=="Presidente y Vicepresidente")
computo$Elección
pvbol<-computo %>% rename(Elección=eleccion) %>% filter(eleccion=="Presidente y Vicepresidente")
library(dplyr)
pvbol<-computo %>% rename(Elección=eleccion) %>% filter(eleccion=="Presidente y Vicepresidente")
names(computo)
?rename
pvbol<-computo %>% rename(eleccion=Elección) %>% filter(eleccion=="Presidente y Vicepresidente")
sp_pvbol<-copy_to(sc,pvbol)
# 3. Exploración de los datos / ("Modelado")
sdf_describe(pvbol)
# 3. Exploración de los datos / ("Modelado")
names(pvbol)
names(sp_pvbol)
glimpse(sp_pvbol)
glimpse(sp_importaciones)
sdf_describe(sp_importaciones)
sdf_describe(sp_pvbol)
sdf_describe(sp_pvbol,c("CC"))
summary(pvbol$CC)
summary(sp_pvbol)
###########################################################
# cargar el pvbol
sp_pvbol<-copy_to(sc,pvbol,name="elecciones")
sp_importaciones %>% group_by(ADUANA) %>% count()
sp_importaciones %>% group_by(DESADU) %>% count()
sp_importaciones %>% group_by(DESADU) %>% count()
sp_importaciones %>% group_by(DESADU) %>% count() %>% collect()
a1<-sp_importaciones %>% group_by(DESADU) %>% count()
a1
View(a1)
a1<-sp_importaciones %>% group_by(DESADU) %>% count() %>% collect()
View(a1)
sp_a2<-sp_importaciones %>% group_by(DESADU) %>% count() %>% compute("a2") # guardar la salida en Spark
sp_importaciones %>% group_by(GESTION,DESADU) %>% count()
sp_importaciones %>% group_by(DESADU, GESTION) %>% count()
sp_importaciones %>% group_by(GESTION,NANDINA,DESNAN) %>% summarise(sum(KILBRU))
sp_importaciones %>% group_by(GESTION,NANDINA,DESNAN) %>% summarise(peso=sum(KILBRU,na.rm=T))
sp_importaciones %>% group_by(GESTION,NANDINA,DESNAN) %>% summarise(peso_ton=sum(KILBRU,na.rm=T)/1000)
sp_importaciones %>% group_by(GESTION,NANDINA,DESNAN) %>% summarise(peso_ton=sum(KILBRU,na.rm=T)/1000) %>% arrange(desc(peso_ton))
sp_importaciones %>% group_by(GESTION,NANDINA,DESNAN) %>% summarise(peso_ton=sum(KILBRU,na.rm=T)/1000) %>% arrange(GESTION,desc(peso_ton))
t1<-sp_importaciones %>% group_by(GESTION,NANDINA,DESNAN) %>% summarise(peso_ton=sum(KILBRU,na.rm=T)/1000) %>% arrange(GESTION,desc(peso_ton)) %>% collect()
View(t1)
sp_importaciones %>% count()
library(DBI)
library(DBI)
library(help=DBI)
dbGetQuery(sc,"Select * from importaciones limit 5")
aux<-dbGetQuery(sc,"Select * from importaciones limit 5")
lm(FOB~PAG,data=sp_importaciones)
lm(FOB~PAG,data=sp_importaciones)
?ml_linear_regression()
sp_importaciones %>% ml_linear_regression(FOB~PAG)
mod1<-sp_importaciones %>% select(FOB,PAG) %>% ml_linear_regression(FOB~.)
# Final. Cerrar la conexión a Spark
spark_disconnect()
# Final. Cerrar la conexión a Spark
spark_disconnect_all()
# Final. Cerrar la conexión a Spark
spark_disconnect_all()
# Final. Cerrar la conexión a Spark
spark_disconnect_all()
# 1. Conexión con Spark
sc <- spark_connect(master = "local", version = "2.4.3")
sp_importaciones<-spark_read_csv(sc,
name="importaciones",
path = "C:\\Users\\ALVARO\\Desktop\\db_bolivia\\importaciones\\importaciones_csv")#carpeta
mod1<-sp_importaciones %>% select(FOB,PAG) %>% ml_linear_regression(FOB~.)
mod1
ggplot(sp_importaciones,aes(DESDEPTO))+geom_bar()
ggplot(sp_importaciones,aes(DESDEPTO))+geom_bar()+facet_wrap(~GESTION)
ggplot(sp_importaciones,aes(KILBRU))+geom_histogram()+facet_wrap(~GESTION)
ggplot(sp_importaciones,aes(KILBRU))+geom_histogram()
library(dbplot)
sp_importaciones %>% dbplot_histogram(KILBRU)
sp_importaciones %>% dbplot_histogram(FOB)
sp_importaciones %>% dbplot_bar(DESDEPTO)
sp_importaciones %>% dbplot_bar(DESDEPTO)
ggplot(sp_importaciones,aes(DESDEPTO))+geom_bar()
bookdown::clean_book(TRUE)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
bookdown::clean_book(TRUE)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
bookdown::clean_book(TRUE)
bookdown::render_book("index.Rmd", "bookdown::gitbook")
