<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 R y Spark | Big Data en R</title>
  <meta name="description" content="Este libro esta destinado a la materia de Programación Estadística I de la carrera de Estadística de la Universidad Mayor de San Andres." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 R y Spark | Big Data en R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Este libro esta destinado a la materia de Programación Estadística I de la carrera de Estadística de la Universidad Mayor de San Andres." />
  <meta name="github-repo" content="alvarolimber/EST-383" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 R y Spark | Big Data en R" />
  
  <meta name="twitter:description" content="Este libro esta destinado a la materia de Programación Estadística I de la carrera de Estadística de la Universidad Mayor de San Andres." />
  

<meta name="author" content="Alvaro Chirino Gutierrez" />


<meta name="date" content="2020-07-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="big-data-en-r.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prefacio</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#audiencia"><i class="fa fa-check"></i>Audiencia</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#estructura-del-libro"><i class="fa fa-check"></i>Estructura del libro</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-y-acuerdos"><i class="fa fa-check"></i>Software y acuerdos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#bases-de-datos"><i class="fa fa-check"></i>Bases de datos</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#agradecimiento"><i class="fa fa-check"></i>Agradecimiento</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="acerca-del-autor.html"><a href="acerca-del-autor.html"><i class="fa fa-check"></i>Acerca del autor</a></li>
<li class="chapter" data-level="1" data-path="introR.html"><a href="introR.html"><i class="fa fa-check"></i><b>1</b> Introducción a R</a><ul>
<li class="chapter" data-level="1.1" data-path="introR.html"><a href="introR.html#tipos-de-estructuras"><i class="fa fa-check"></i><b>1.1</b> Tipos de estructuras</a></li>
<li class="chapter" data-level="1.2" data-path="introR.html"><a href="introR.html#loops-y-condiciones"><i class="fa fa-check"></i><b>1.2</b> Loops y condiciones</a></li>
<li class="chapter" data-level="1.3" data-path="introR.html"><a href="introR.html#funciones"><i class="fa fa-check"></i><b>1.3</b> Funciones</a></li>
<li class="chapter" data-level="1.4" data-path="introR.html"><a href="introR.html#importacion-de-datos"><i class="fa fa-check"></i><b>1.4</b> Importacion de datos</a></li>
<li class="chapter" data-level="1.5" data-path="introR.html"><a href="introR.html#dataframe-y-exploración"><i class="fa fa-check"></i><b>1.5</b> Dataframe y exploración</a></li>
<li class="chapter" data-level="1.6" data-path="introR.html"><a href="introR.html#estadística-descriptiva"><i class="fa fa-check"></i><b>1.6</b> Estadística descriptiva</a></li>
<li class="chapter" data-level="1.7" data-path="introR.html"><a href="introR.html#muestreo-e-inferencia"><i class="fa fa-check"></i><b>1.7</b> Muestreo e inferencia</a></li>
<li class="chapter" data-level="1.8" data-path="introR.html"><a href="introR.html#gráficos-de-origen"><i class="fa fa-check"></i><b>1.8</b> Gráficos de origen</a></li>
<li class="chapter" data-level="1.9" data-path="introR.html"><a href="introR.html#ggplot"><i class="fa fa-check"></i><b>1.9</b> ggplot</a></li>
<li class="chapter" data-level="1.10" data-path="introR.html"><a href="introR.html#r-markdown"><i class="fa fa-check"></i><b>1.10</b> R Markdown</a><ul>
<li class="chapter" data-level="1.10.1" data-path="introR.html"><a href="introR.html#instalación"><i class="fa fa-check"></i><b>1.10.1</b> Instalación</a></li>
<li class="chapter" data-level="1.10.2" data-path="introR.html"><a href="introR.html#yaml-header"><i class="fa fa-check"></i><b>1.10.2</b> YAML Header</a></li>
<li class="chapter" data-level="1.10.3" data-path="introR.html"><a href="introR.html#sintaxis-básica"><i class="fa fa-check"></i><b>1.10.3</b> Sintaxis básica</a></li>
<li class="chapter" data-level="1.10.4" data-path="introR.html"><a href="introR.html#tipos-de-documentos"><i class="fa fa-check"></i><b>1.10.4</b> Tipos de documentos</a></li>
<li class="chapter" data-level="1.10.5" data-path="introR.html"><a href="introR.html#chunks"><i class="fa fa-check"></i><b>1.10.5</b> Chunks</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="introR.html"><a href="introR.html#shiny"><i class="fa fa-check"></i><b>1.11</b> Shiny</a><ul>
<li class="chapter" data-level="1.11.1" data-path="introR.html"><a href="introR.html#ui"><i class="fa fa-check"></i><b>1.11.1</b> UI</a></li>
<li class="chapter" data-level="1.11.2" data-path="introR.html"><a href="introR.html#server"><i class="fa fa-check"></i><b>1.11.2</b> Server</a></li>
</ul></li>
<li class="chapter" data-level="1.12" data-path="introR.html"><a href="introR.html#ejercicios-propuestos"><i class="fa fa-check"></i><b>1.12</b> Ejercicios Propuestos</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="scraping-web.html"><a href="scraping-web.html"><i class="fa fa-check"></i><b>2</b> Scraping Web</a><ul>
<li class="chapter" data-level="2.1" data-path="scraping-web.html"><a href="scraping-web.html#pasos-para-la-recopilación-de-información"><i class="fa fa-check"></i><b>2.1</b> Pasos para la recopilación de información</a></li>
<li class="chapter" data-level="2.2" data-path="scraping-web.html"><a href="scraping-web.html#tecnologías-de-diseminación-extracción-y-almacenamiento-web"><i class="fa fa-check"></i><b>2.2</b> Tecnologías de diseminación, extracción y almacenamiento Web</a></li>
<li class="chapter" data-level="2.3" data-path="scraping-web.html"><a href="scraping-web.html#librerías-en-r"><i class="fa fa-check"></i><b>2.3</b> Librerías en R</a></li>
<li class="chapter" data-level="2.4" data-path="scraping-web.html"><a href="scraping-web.html#librería-rvest"><i class="fa fa-check"></i><b>2.4</b> Librería rvest</a></li>
<li class="chapter" data-level="2.5" data-path="scraping-web.html"><a href="scraping-web.html#ejemplo-ketal"><i class="fa fa-check"></i><b>2.5</b> Ejemplo: Ketal</a></li>
<li class="chapter" data-level="2.6" data-path="scraping-web.html"><a href="scraping-web.html#ejemplo-ministerio-de-educación"><i class="fa fa-check"></i><b>2.6</b> Ejemplo: Ministerio de Educación</a></li>
<li class="chapter" data-level="2.7" data-path="scraping-web.html"><a href="scraping-web.html#ejemplo-informacion-covid-19-en-bolivia"><i class="fa fa-check"></i><b>2.7</b> Ejemplo, informacion COVID-19 en Bolivia</a></li>
<li class="chapter" data-level="2.8" data-path="scraping-web.html"><a href="scraping-web.html#apis"><i class="fa fa-check"></i><b>2.8</b> APIs</a><ul>
<li class="chapter" data-level="2.8.1" data-path="scraping-web.html"><a href="scraping-web.html#api-banco-mundial"><i class="fa fa-check"></i><b>2.8.1</b> API Banco Mundial</a></li>
<li class="chapter" data-level="2.8.2" data-path="scraping-web.html"><a href="scraping-web.html#api-google-trends"><i class="fa fa-check"></i><b>2.8.2</b> API Google trends</a></li>
<li class="chapter" data-level="2.8.3" data-path="scraping-web.html"><a href="scraping-web.html#api-google-maps"><i class="fa fa-check"></i><b>2.8.3</b> API Google Maps</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="scraping-web.html"><a href="scraping-web.html#ejercicios-propuestos-1"><i class="fa fa-check"></i><b>2.9</b> Ejercicios Propuestos</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html"><i class="fa fa-check"></i><b>3</b> Introducción al Big Data</a><ul>
<li class="chapter" data-level="3.1" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#definiendo-al-big-data"><i class="fa fa-check"></i><b>3.1</b> Definiendo al Big Data</a></li>
<li class="chapter" data-level="3.2" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#las-5-v-en-el-big-data"><i class="fa fa-check"></i><b>3.2</b> Las 5 V en el Big Data</a></li>
<li class="chapter" data-level="3.3" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#ciclo-de-vida-de-un-proyecto-de-análisis-de-datos"><i class="fa fa-check"></i><b>3.3</b> Ciclo de vida de un proyecto de análisis de datos</a></li>
<li class="chapter" data-level="3.4" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#inferencia-y-big-data"><i class="fa fa-check"></i><b>3.4</b> Inferencia y Big Data</a><ul>
<li class="chapter" data-level="3.4.1" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#descriptivo"><i class="fa fa-check"></i><b>3.4.1</b> Descriptivo</a></li>
<li class="chapter" data-level="3.4.2" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#causal"><i class="fa fa-check"></i><b>3.4.2</b> Causal</a></li>
<li class="chapter" data-level="3.4.3" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#predictivo"><i class="fa fa-check"></i><b>3.4.3</b> Predictivo</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#calidad-de-dato-y-big-data"><i class="fa fa-check"></i><b>3.5</b> Calidad de dato y Big Data</a></li>
<li class="chapter" data-level="3.6" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#captura-y-preservación"><i class="fa fa-check"></i><b>3.6</b> Captura y preservación</a><ul>
<li class="chapter" data-level="3.6.1" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#fuentes-convencionales"><i class="fa fa-check"></i><b>3.6.1</b> Fuentes convencionales</a></li>
<li class="chapter" data-level="3.6.2" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#datos-web-y-apis"><i class="fa fa-check"></i><b>3.6.2</b> Datos web y APIs</a></li>
<li class="chapter" data-level="3.6.3" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#record-linkage"><i class="fa fa-check"></i><b>3.6.3</b> Record Linkage</a></li>
<li class="chapter" data-level="3.6.4" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#bases-de-datos-1"><i class="fa fa-check"></i><b>3.6.4</b> Bases de datos</a></li>
<li class="chapter" data-level="3.6.5" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#programando-con-big-data"><i class="fa fa-check"></i><b>3.6.5</b> Programando con Big Data</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#análisis-y-modelado"><i class="fa fa-check"></i><b>3.7</b> Análisis y modelado</a><ul>
<li class="chapter" data-level="3.7.1" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#machine-learning"><i class="fa fa-check"></i><b>3.7.1</b> Machine learning</a></li>
<li class="chapter" data-level="3.7.2" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#análisis-de-texto-entendiendo-lo-que-la-gente-escribe"><i class="fa fa-check"></i><b>3.7.2</b> Análisis de texto: Entendiendo lo que la gente escribe</a></li>
<li class="chapter" data-level="3.7.3" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#networks"><i class="fa fa-check"></i><b>3.7.3</b> Networks</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#inferencia-y-ética"><i class="fa fa-check"></i><b>3.8</b> Inferencia y ética</a><ul>
<li class="chapter" data-level="3.8.1" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#información-y-visualización"><i class="fa fa-check"></i><b>3.8.1</b> Información y visualización</a></li>
<li class="chapter" data-level="3.8.2" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#error-e-inferencia"><i class="fa fa-check"></i><b>3.8.2</b> Error e inferencia</a></li>
<li class="chapter" data-level="3.8.3" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#privacidad-y-confidencialidad"><i class="fa fa-check"></i><b>3.8.3</b> Privacidad y confidencialidad</a></li>
<li class="chapter" data-level="3.8.4" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#workbooks"><i class="fa fa-check"></i><b>3.8.4</b> Workbooks</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="introducción-al-big-data.html"><a href="introducción-al-big-data.html#ejercicios-propuestos-2"><i class="fa fa-check"></i><b>3.9</b> Ejercicios Propuestos</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="big-data-en-r.html"><a href="big-data-en-r.html"><i class="fa fa-check"></i><b>4</b> Big Data en R</a><ul>
<li class="chapter" data-level="4.1" data-path="big-data-en-r.html"><a href="big-data-en-r.html#limitaciones-en-r"><i class="fa fa-check"></i><b>4.1</b> Limitaciones en R</a><ul>
<li class="chapter" data-level="4.1.1" data-path="big-data-en-r.html"><a href="big-data-en-r.html#memoria"><i class="fa fa-check"></i><b>4.1.1</b> Memoria</a></li>
<li class="chapter" data-level="4.1.2" data-path="big-data-en-r.html"><a href="big-data-en-r.html#velocidad-de-procesamiento"><i class="fa fa-check"></i><b>4.1.2</b> Velocidad de procesamiento</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="big-data-en-r.html"><a href="big-data-en-r.html#a-los-límites-de-la-memoria-y-más-allá"><i class="fa fa-check"></i><b>4.2</b> A los límites de la memoria y más allá</a><ul>
<li class="chapter" data-level="4.2.1" data-path="big-data-en-r.html"><a href="big-data-en-r.html#transformacion-y-agregación-de-datos-con-la-librería-ff-y-ffbase"><i class="fa fa-check"></i><b>4.2.1</b> Transformacion y agregación de datos con la librería ff y ffbase</a></li>
<li class="chapter" data-level="4.2.2" data-path="big-data-en-r.html"><a href="big-data-en-r.html#modelos-glm-con-la-las-librerias-ff-y-ffbase"><i class="fa fa-check"></i><b>4.2.2</b> Modelos GLM con la las librerias ff y ffbase</a></li>
<li class="chapter" data-level="4.2.3" data-path="big-data-en-r.html"><a href="big-data-en-r.html#expandiendo-la-memoria-con-la-libreria-bigmemory"><i class="fa fa-check"></i><b>4.2.3</b> Expandiendo la memoria con la libreria bigmemory</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="big-data-en-r.html"><a href="big-data-en-r.html#parallel-r"><i class="fa fa-check"></i><b>4.3</b> Parallel R</a><ul>
<li class="chapter" data-level="4.3.1" data-path="big-data-en-r.html"><a href="big-data-en-r.html#libreria-parallel"><i class="fa fa-check"></i><b>4.3.1</b> Libreria parallel</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="r-y-spark.html"><a href="r-y-spark.html"><i class="fa fa-check"></i><b>5</b> R y Spark</a><ul>
<li class="chapter" data-level="5.1" data-path="r-y-spark.html"><a href="r-y-spark.html#introducción"><i class="fa fa-check"></i><b>5.1</b> Introducción</a><ul>
<li class="chapter" data-level="5.1.1" data-path="r-y-spark.html"><a href="r-y-spark.html#hadoop"><i class="fa fa-check"></i><b>5.1.1</b> Hadoop</a></li>
<li class="chapter" data-level="5.1.2" data-path="r-y-spark.html"><a href="r-y-spark.html#spark"><i class="fa fa-check"></i><b>5.1.2</b> Spark</a></li>
<li class="chapter" data-level="5.1.3" data-path="r-y-spark.html"><a href="r-y-spark.html#sparklyr"><i class="fa fa-check"></i><b>5.1.3</b> Sparklyr</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="r-y-spark.html"><a href="r-y-spark.html#arrancando-spark"><i class="fa fa-check"></i><b>5.2</b> Arrancando Spark</a><ul>
<li class="chapter" data-level="5.2.1" data-path="r-y-spark.html"><a href="r-y-spark.html#prerequisitos"><i class="fa fa-check"></i><b>5.2.1</b> Prerequisitos</a></li>
<li class="chapter" data-level="5.2.2" data-path="r-y-spark.html"><a href="r-y-spark.html#instalación-1"><i class="fa fa-check"></i><b>5.2.2</b> Instalación</a></li>
<li class="chapter" data-level="5.2.3" data-path="r-y-spark.html"><a href="r-y-spark.html#creando-una-sesión-en-spark"><i class="fa fa-check"></i><b>5.2.3</b> Creando una sesión en Spark</a></li>
<li class="chapter" data-level="5.2.4" data-path="r-y-spark.html"><a href="r-y-spark.html#interface-web"><i class="fa fa-check"></i><b>5.2.4</b> Interface web</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="r-y-spark.html"><a href="r-y-spark.html#análisis-con-spark"><i class="fa fa-check"></i><b>5.3</b> Análisis con Spark</a><ul>
<li class="chapter" data-level="5.3.1" data-path="r-y-spark.html"><a href="r-y-spark.html#importando-los-datos"><i class="fa fa-check"></i><b>5.3.1</b> Importando los datos</a></li>
<li class="chapter" data-level="5.3.2" data-path="r-y-spark.html"><a href="r-y-spark.html#librería-dplyr-gramática-de-manipulación-de-datos"><i class="fa fa-check"></i><b>5.3.2</b> Librería DPLYR (Gramática de manipulación de datos)</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data en R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-y-spark" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> R y Spark</h1>
<div id="introducción" class="section level2">
<h2><span class="header-section-number">5.1</span> Introducción</h2>
<p>En este capítulo emplearemos Spark junto con R para el procesamiento de datos. Spark es un framework que permite realizar procesos de división y paralelismo en un equipo o múltiples equipos.</p>
<div id="hadoop" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Hadoop</h3>
<p>Google (2004) publicó un nuevo documento que describe cómo realizar operaciones en todo el Sistema de archivos de Google, un enfoque que se conoció como MapReduce. Como era de esperar, hay dos operaciones en MapReduce: map y reduce. La operación de map proporciona una forma arbitraria de transformar cada archivo en un nuevo archivo, mientras que la operación de reduce combina dos archivos. Ambas operaciones requieren un código de computadora personalizado, pero el marco MapReduce se encarga de ejecutarlas automáticamente en muchas computadoras a la vez. Estas dos operaciones son suficientes para procesar todos los datos disponibles en la web, al tiempo que proporcionan suficiente flexibilidad para extraer información significativa de la misma.</p>
</div>
<div id="spark" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Spark</h3>
<p>En 2009, Apache Spark comenzó como un proyecto de investigación en AMPLab de UC Berkeley para mejorar MapReduce. Específicamente, Spark proporcionó un conjunto más rico de verbos más allá de MapReduce para facilitar la optimización del código que se ejecuta en múltiples máquinas. Spark también cargó datos en la memoria, lo que hace que las operaciones sean mucho más rápidas que el almacenamiento en disco de Hadoop</p>
<div class="figure">
<img src="images/spark1.png" alt="" />
<p class="caption">Spark</p>
</div>
<p>Componetes:</p>
<ol style="list-style-type: decimal">
<li>Spark Core: Base donde se apoya el resto de los componentes</li>
<li>Spark SQL: Procesamiento de dato estructurados y no estructurados</li>
<li>Spark streaming: Procesamiento de datos en tiempo real.</li>
<li>Spark MLLib: Machine learning</li>
<li>Spark graph: Procesamiento de grafos</li>
</ol>
<p>Algunos conceptos importantes</p>
<blockquote>
<p>HDFS: Sistema de ficheros</p>
</blockquote>
</div>
<div id="sparklyr" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Sparklyr</h3>
<p>Oficialmente, sparklyr es una interfaz R para Apache Spark. Está disponible en CRAN y funciona como cualquier otro paquete de CRAN, lo que significa que es independiente de las versiones de Spark, es fácil de instalar, sirve a la comunidad R, abarca otros paquetes y prácticas de la comunidad R, y así sucesivamente. Está alojado en GitHub y tiene licencia de Apache 2.0, que le permite clonar, modificar y contribuir de nuevo a este proyecto.</p>
</div>
</div>
<div id="arrancando-spark" class="section level2">
<h2><span class="header-section-number">5.2</span> Arrancando Spark</h2>
<div id="prerequisitos" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Prerequisitos</h3>
<ul>
<li>R</li>
<li>RStudio</li>
<li>Java 8</li>
</ul>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="r-y-spark.html#cb134-1"></a><span class="kw">system</span>(<span class="st">&quot;java -version&quot;</span>)</span></code></pre></div>
</div>
<div id="instalación-1" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Instalación</h3>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="r-y-spark.html#cb135-1"></a><span class="co">#instalar la libraría sparlyr</span></span>
<span id="cb135-2"><a href="r-y-spark.html#cb135-2"></a><span class="kw">install.packages</span>(<span class="st">&quot;sparklyr&quot;</span>)</span>
<span id="cb135-3"><a href="r-y-spark.html#cb135-3"></a><span class="co">#Habilitando la librería</span></span>
<span id="cb135-4"><a href="r-y-spark.html#cb135-4"></a><span class="kw">library</span>(sparklyr)</span>
<span id="cb135-5"><a href="r-y-spark.html#cb135-5"></a><span class="co">#versiones disponibles</span></span>
<span id="cb135-6"><a href="r-y-spark.html#cb135-6"></a><span class="kw">spark_available_versions</span>()</span>
<span id="cb135-7"><a href="r-y-spark.html#cb135-7"></a><span class="co">#versiones instaladas</span></span>
<span id="cb135-8"><a href="r-y-spark.html#cb135-8"></a><span class="kw">spark_installed_versions</span>()</span>
<span id="cb135-9"><a href="r-y-spark.html#cb135-9"></a><span class="co">#instalando spark desde R</span></span>
<span id="cb135-10"><a href="r-y-spark.html#cb135-10"></a><span class="kw">spark_install</span>(<span class="st">&quot;2.3&quot;</span>)</span>
<span id="cb135-11"><a href="r-y-spark.html#cb135-11"></a><span class="co">#spark_install(version=&quot;2.3&quot;)</span></span></code></pre></div>
</div>
<div id="creando-una-sesión-en-spark" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Creando una sesión en Spark</h3>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="r-y-spark.html#cb136-1"></a><span class="co">#inicia la sesión</span></span>
<span id="cb136-2"><a href="r-y-spark.html#cb136-2"></a>sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local&quot;</span>, <span class="dt">version =</span> <span class="st">&quot;2.4.3&quot;</span>)</span>
<span id="cb136-3"><a href="r-y-spark.html#cb136-3"></a><span class="kw">spark_disconnect</span>(sc)</span>
<span id="cb136-4"><a href="r-y-spark.html#cb136-4"></a><span class="co">#configuración</span></span>
<span id="cb136-5"><a href="r-y-spark.html#cb136-5"></a>conf &lt;-<span class="st"> </span><span class="kw">spark_config</span>()</span>
<span id="cb136-6"><a href="r-y-spark.html#cb136-6"></a>  conf<span class="op">$</span><span class="st">`</span><span class="dt">sparklyr.shell.driver-memory</span><span class="st">`</span> &lt;-<span class="st"> &quot;2G&quot;</span></span>
<span id="cb136-7"><a href="r-y-spark.html#cb136-7"></a>  conf<span class="op">$</span>spark.memory.fraction &lt;-<span class="st"> </span><span class="fl">0.8</span> </span>
<span id="cb136-8"><a href="r-y-spark.html#cb136-8"></a>  <span class="co">#spark_home=&quot;C:\\Users\\ALVARO\\AppData\\Local\\spark\\spark-2.4.3-bin-hadoop2.7&quot;</span></span>
<span id="cb136-9"><a href="r-y-spark.html#cb136-9"></a>  <span class="co">#conf$sparklyr.gateway.port &lt;- 9090</span></span>
<span id="cb136-10"><a href="r-y-spark.html#cb136-10"></a><span class="co">#conección  </span></span>
<span id="cb136-11"><a href="r-y-spark.html#cb136-11"></a>sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local&quot;</span>, <span class="dt">version =</span> <span class="st">&quot;2.4.3&quot;</span>,<span class="dt">config =</span> conf)  </span>
<span id="cb136-12"><a href="r-y-spark.html#cb136-12"></a><span class="co">#apagar conexión</span></span>
<span id="cb136-13"><a href="r-y-spark.html#cb136-13"></a><span class="kw">spark_disconnect</span>(sc)</span>
<span id="cb136-14"><a href="r-y-spark.html#cb136-14"></a><span class="kw">spark_disconnect_all</span>()</span></code></pre></div>
</div>
<div id="interface-web" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Interface web</h3>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="r-y-spark.html#cb137-1"></a><span class="kw">spark_web</span>(sc)</span></code></pre></div>
<ul>
<li><p><a href="http://localhost:4040/jobs/" class="uri">http://localhost:4040/jobs/</a></p></li>
<li><p><a href="http://127.0.0.1:4040/executors/" class="uri">http://127.0.0.1:4040/executors/</a></p></li>
<li><p>Jobs</p></li>
<li><p>Stages</p></li>
<li><p>Storage</p></li>
<li><p>Environment</p></li>
<li><p>Executors</p></li>
<li><p>SQL</p></li>
</ul>
</div>
</div>
<div id="análisis-con-spark" class="section level2">
<h2><span class="header-section-number">5.3</span> Análisis con Spark</h2>
<div class="figure">
<img src="images/spark2.png" alt="" />
<p class="caption">Pasos en el análisis de datos</p>
</div>
<div id="importando-los-datos" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Importando los datos</h3>
<p>Por lo general, importar significa que R leerá los archivos y los cargará en la memoria; cuando se usa Spark, los datos se importan a Spark, no a R.</p>
<p><img src="images/spark3.png" /></p>
<p><img src="images/spark4.PNG" /></p>
<p>Colección de documentos</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="r-y-spark.html#cb138-1"></a><span class="co">#csv/importaciones</span></span>
<span id="cb138-2"><a href="r-y-spark.html#cb138-2"></a>sp_importaciones&lt;-<span class="kw">spark_read_csv</span>(sc,</span>
<span id="cb138-3"><a href="r-y-spark.html#cb138-3"></a>  <span class="dt">name=</span><span class="st">&quot;importaciones&quot;</span>,</span>
<span id="cb138-4"><a href="r-y-spark.html#cb138-4"></a>  <span class="dt">path =</span> <span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">ALVARO</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">db_bolivia</span><span class="ch">\\</span><span class="st">importaciones</span><span class="ch">\\</span><span class="st">importaciones_csv&quot;</span>)</span>
<span id="cb138-5"><a href="r-y-spark.html#cb138-5"></a><span class="co">###########</span></span>
<span id="cb138-6"><a href="r-y-spark.html#cb138-6"></a><span class="co">#esquema</span></span>
<span id="cb138-7"><a href="r-y-spark.html#cb138-7"></a><span class="co">###########</span></span>
<span id="cb138-8"><a href="r-y-spark.html#cb138-8"></a>top_rows &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">ALVARO</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">db_bolivia</span><span class="ch">\\</span><span class="st">importaciones</span><span class="ch">\\</span><span class="st">importaciones_csv</span><span class="ch">\\</span><span class="st">1993.csv&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;,&quot;</span>, <span class="dt">nrows =</span> <span class="dv">5</span>)</span>
<span id="cb138-9"><a href="r-y-spark.html#cb138-9"></a>spec_with_r &lt;-<span class="st"> </span><span class="kw">sapply</span>(top_rows, class)</span>
<span id="cb138-10"><a href="r-y-spark.html#cb138-10"></a>spec_with_r[<span class="dv">6</span>]&lt;-<span class="st">&quot;factor&quot;</span></span>
<span id="cb138-11"><a href="r-y-spark.html#cb138-11"></a></span>
<span id="cb138-12"><a href="r-y-spark.html#cb138-12"></a>sp_importaciones2&lt;-<span class="kw">spark_read_csv</span>(sc,</span>
<span id="cb138-13"><a href="r-y-spark.html#cb138-13"></a>  <span class="dt">name=</span><span class="st">&quot;importaciones2&quot;</span>,</span>
<span id="cb138-14"><a href="r-y-spark.html#cb138-14"></a>  <span class="dt">path =</span> <span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">ALVARO</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">db_bolivia</span><span class="ch">\\</span><span class="st">importaciones</span><span class="ch">\\</span><span class="st">importaciones_csv&quot;</span>,</span>
<span id="cb138-15"><a href="r-y-spark.html#cb138-15"></a>  <span class="dt">columns =</span> spec_with_r)</span>
<span id="cb138-16"><a href="r-y-spark.html#cb138-16"></a><span class="co"># memoria</span></span>
<span id="cb138-17"><a href="r-y-spark.html#cb138-17"></a><span class="kw">object.size</span>(sp_importaciones)</span></code></pre></div>
<p>Comando copy_to</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="r-y-spark.html#cb139-1"></a>m1&lt;-<span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">7</span>),<span class="dt">ncol=</span><span class="dv">20</span>))</span>
<span id="cb139-2"><a href="r-y-spark.html#cb139-2"></a><span class="kw">object.size</span>(m1)<span class="op">/</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">6</span>)</span>
<span id="cb139-3"><a href="r-y-spark.html#cb139-3"></a>sp_m1&lt;-<span class="kw">copy_to</span>(sc,m1)</span>
<span id="cb139-4"><a href="r-y-spark.html#cb139-4"></a><span class="kw">rm</span>(m1)</span>
<span id="cb139-5"><a href="r-y-spark.html#cb139-5"></a></span>
<span id="cb139-6"><a href="r-y-spark.html#cb139-6"></a><span class="kw">load</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">ALVARO</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">EST-383</span><span class="ch">\\</span><span class="st">data</span><span class="ch">\\</span><span class="st">oct20.RData&quot;</span>)</span>
<span id="cb139-7"><a href="r-y-spark.html#cb139-7"></a><span class="kw">object.size</span>(computo)<span class="op">/</span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span></span>
<span id="cb139-8"><a href="r-y-spark.html#cb139-8"></a>sp_computo&lt;-<span class="kw">copy_to</span>(sc,computo)</span>
<span id="cb139-9"><a href="r-y-spark.html#cb139-9"></a><span class="kw">rm</span>(computo)</span></code></pre></div>
<p>Documento específico</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="r-y-spark.html#cb140-1"></a>sp_covid&lt;-<span class="kw">spark_read_csv</span>(sc,</span>
<span id="cb140-2"><a href="r-y-spark.html#cb140-2"></a>  <span class="dt">name=</span><span class="st">&quot;covid&quot;</span>,</span>
<span id="cb140-3"><a href="r-y-spark.html#cb140-3"></a>  <span class="dt">path =</span> <span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">ALVARO</span><span class="ch">\\</span><span class="st">Desktop</span><span class="ch">\\</span><span class="st">db_bolivia</span><span class="ch">\\</span><span class="st">bigdata</span><span class="ch">\\</span><span class="st">200614COVID19MEXICO.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="librería-dplyr-gramática-de-manipulación-de-datos" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Librería DPLYR (Gramática de manipulación de datos)</h3>
<ul>
<li><a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html" class="uri">https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html</a></li>
</ul>
<p>Eliminar un objeto en spark</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="r-y-spark.html#cb141-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb141-2"><a href="r-y-spark.html#cb141-2"></a><span class="kw">db_drop_table</span>(sc,<span class="st">&quot;importaciones2&quot;</span>)</span>
<span id="cb141-3"><a href="r-y-spark.html#cb141-3"></a><span class="kw">db_drop_table</span>(sc,<span class="st">&quot;m1&quot;</span>)</span>
<span id="cb141-4"><a href="r-y-spark.html#cb141-4"></a><span class="kw">spark_disconnect</span>(sc)</span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="r-y-spark.html#cb142-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb142-2"><a href="r-y-spark.html#cb142-2"></a><span class="kw">load</span>(<span class="kw">url</span>(<span class="st">&quot;https://github.com/AlvaroLimber/EST-383/raw/master/data/oct20.RData&quot;</span>))</span>
<span id="cb142-3"><a href="r-y-spark.html#cb142-3"></a><span class="kw">names</span>(computo)[<span class="dv">1</span>]&lt;-<span class="st">&quot;pais&quot;</span></span>
<span id="cb142-4"><a href="r-y-spark.html#cb142-4"></a><span class="co">##############################</span></span>
<span id="cb142-5"><a href="r-y-spark.html#cb142-5"></a><span class="co">### Columnas -&gt; variables</span></span>
<span id="cb142-6"><a href="r-y-spark.html#cb142-6"></a><span class="co">##############################</span></span>
<span id="cb142-7"><a href="r-y-spark.html#cb142-7"></a><span class="co">#cambio de nombre de las variables</span></span>
<span id="cb142-8"><a href="r-y-spark.html#cb142-8"></a>computo&lt;-computo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">mas=</span><span class="st">`</span><span class="dt">MAS - IPSP</span><span class="st">`</span>,<span class="dt">cc=</span>CC)</span>
<span id="cb142-9"><a href="r-y-spark.html#cb142-9"></a>computo&lt;-computo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">idep=</span><span class="st">`</span><span class="dt">Número departamento</span><span class="st">`</span>,<span class="dt">imun=</span><span class="dv">5</span>)</span>
<span id="cb142-10"><a href="r-y-spark.html#cb142-10"></a><span class="kw">names</span>(computo)</span>
<span id="cb142-11"><a href="r-y-spark.html#cb142-11"></a><span class="co"># Selección de variables</span></span>
<span id="cb142-12"><a href="r-y-spark.html#cb142-12"></a>bd1&lt;-computo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(pais,cc,mas)</span>
<span id="cb142-13"><a href="r-y-spark.html#cb142-13"></a><span class="kw">head</span>(bd1)</span>
<span id="cb142-14"><a href="r-y-spark.html#cb142-14"></a><span class="co"># Crear nuevas variables</span></span>
<span id="cb142-15"><a href="r-y-spark.html#cb142-15"></a>bd1&lt;-bd1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">a=</span><span class="dv">1</span>,<span class="dt">s_mas_cc=</span>cc<span class="op">+</span>mas,<span class="dt">raiz_mas=</span><span class="kw">sqrt</span>(mas),<span class="dt">lcc=</span><span class="kw">log</span>(cc))</span>
<span id="cb142-16"><a href="r-y-spark.html#cb142-16"></a>bd1&lt;-bd1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">mas100=</span>mas<span class="op">&gt;</span><span class="dv">100</span>,<span class="dt">mean_mas=</span>mas<span class="op">&gt;</span><span class="kw">mean</span>(mas))</span>
<span id="cb142-17"><a href="r-y-spark.html#cb142-17"></a><span class="co"># ordenando las variables  </span></span>
<span id="cb142-18"><a href="r-y-spark.html#cb142-18"></a>bd1&lt;-bd1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">relocate</span>(lcc<span class="op">:</span>mas,<span class="dt">before=</span>a)<span class="co">#pendiente</span></span>
<span id="cb142-19"><a href="r-y-spark.html#cb142-19"></a>bd1[,<span class="kw">c</span>(<span class="st">&quot;cc&quot;</span>,<span class="st">&quot;pais&quot;</span>,<span class="st">&quot;a&quot;</span>)]</span>
<span id="cb142-20"><a href="r-y-spark.html#cb142-20"></a><span class="co">##############################</span></span>
<span id="cb142-21"><a href="r-y-spark.html#cb142-21"></a><span class="co">### Filas-&gt; Observaciones</span></span>
<span id="cb142-22"><a href="r-y-spark.html#cb142-22"></a><span class="co">##############################</span></span>
<span id="cb142-23"><a href="r-y-spark.html#cb142-23"></a><span class="co">#filtrado</span></span>
<span id="cb142-24"><a href="r-y-spark.html#cb142-24"></a><span class="co"># elección presidencial solo Bolivia </span></span>
<span id="cb142-25"><a href="r-y-spark.html#cb142-25"></a>pv&lt;-computo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Elección==<span class="st">&quot;Presidente y Vicepresidente&quot;</span>)</span>
<span id="cb142-26"><a href="r-y-spark.html#cb142-26"></a>pvbol&lt;-computo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Elección==<span class="st">&quot;Presidente y Vicepresidente&quot;</span> <span class="op">&amp;</span><span class="st"> </span>pais<span class="op">==</span><span class="st">&quot;Bolivia&quot;</span>)</span>
<span id="cb142-27"><a href="r-y-spark.html#cb142-27"></a><span class="co">##############################</span></span>
<span id="cb142-28"><a href="r-y-spark.html#cb142-28"></a><span class="co">### Resumen estadístico</span></span>
<span id="cb142-29"><a href="r-y-spark.html#cb142-29"></a><span class="co">##############################</span></span>
<span id="cb142-30"><a href="r-y-spark.html#cb142-30"></a><span class="co"># summarise</span></span>
<span id="cb142-31"><a href="r-y-spark.html#cb142-31"></a>pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">media_mas=</span><span class="kw">mean</span>(mas),<span class="dt">media_cc=</span><span class="kw">mean</span>(cc),<span class="dt">max_mas=</span><span class="kw">max</span>(mas),<span class="dt">max_cc=</span><span class="kw">max</span>(cc))</span>
<span id="cb142-32"><a href="r-y-spark.html#cb142-32"></a>pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">p100mas=</span><span class="kw">mean</span>(mas<span class="op">&gt;</span><span class="dv">100</span>)<span class="op">*</span><span class="dv">100</span>,<span class="dt">p100cc=</span><span class="kw">mean</span>(cc<span class="op">&gt;</span><span class="dv">100</span>)<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb142-33"><a href="r-y-spark.html#cb142-33"></a><span class="co"># group_by</span></span>
<span id="cb142-34"><a href="r-y-spark.html#cb142-34"></a>pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">p100mas=</span><span class="kw">mean</span>(mas<span class="op">&gt;</span><span class="dv">100</span>)<span class="op">*</span><span class="dv">100</span>,<span class="dt">p100cc=</span><span class="kw">mean</span>(cc<span class="op">&gt;</span><span class="dv">100</span>)<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb142-35"><a href="r-y-spark.html#cb142-35"></a></span>
<span id="cb142-36"><a href="r-y-spark.html#cb142-36"></a>pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento,Provincia) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">p100mas=</span><span class="kw">mean</span>(mas<span class="op">&gt;</span><span class="dv">100</span>)<span class="op">*</span><span class="dv">100</span>,<span class="dt">p100cc=</span><span class="kw">mean</span>(cc<span class="op">&gt;</span><span class="dv">100</span>)<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb142-37"><a href="r-y-spark.html#cb142-37"></a><span class="co">#count tally</span></span>
<span id="cb142-38"><a href="r-y-spark.html#cb142-38"></a>pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento,Provincia) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>()</span>
<span id="cb142-39"><a href="r-y-spark.html#cb142-39"></a>pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento,Provincia) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>()</span>
<span id="cb142-40"><a href="r-y-spark.html#cb142-40"></a><span class="co"># encadenamiento masivo</span></span>
<span id="cb142-41"><a href="r-y-spark.html#cb142-41"></a>pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Departamento<span class="op">==</span><span class="st">&quot;Beni&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(mas,cc) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>()</span>
<span id="cb142-42"><a href="r-y-spark.html#cb142-42"></a>pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Departamento<span class="op">==</span><span class="st">&quot;Beni&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(mas,cc) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">cor</span>()</span></code></pre></div>
<p>DPLYR en Spark</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="r-y-spark.html#cb143-1"></a><span class="kw">library</span>(sparklyr)</span>
<span id="cb143-2"><a href="r-y-spark.html#cb143-2"></a>sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local&quot;</span>, <span class="dt">version =</span> <span class="st">&quot;2.4.3&quot;</span>)</span>
<span id="cb143-3"><a href="r-y-spark.html#cb143-3"></a><span class="kw">spark_web</span>(sc)</span>
<span id="cb143-4"><a href="r-y-spark.html#cb143-4"></a><span class="co"># cargar el pvbol</span></span>
<span id="cb143-5"><a href="r-y-spark.html#cb143-5"></a>sp_pvbol&lt;-<span class="kw">copy_to</span>(sc,pvbol,<span class="dt">name=</span><span class="st">&quot;elecciones&quot;</span>)</span>
<span id="cb143-6"><a href="r-y-spark.html#cb143-6"></a><span class="kw">rm</span>(pvbol)</span>
<span id="cb143-7"><a href="r-y-spark.html#cb143-7"></a><span class="co"># interactuar con la base en spark</span></span>
<span id="cb143-8"><a href="r-y-spark.html#cb143-8"></a>sp_pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>()</span>
<span id="cb143-9"><a href="r-y-spark.html#cb143-9"></a>t0&lt;-sp_pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>()</span>
<span id="cb143-10"><a href="r-y-spark.html#cb143-10"></a><span class="co">#collect es para guardar la salida en la memoria de R</span></span>
<span id="cb143-11"><a href="r-y-spark.html#cb143-11"></a>t1&lt;-sp_pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collect</span>()</span>
<span id="cb143-12"><a href="r-y-spark.html#cb143-12"></a><span class="co"># compute es para guardar la salida en la memoria de spark</span></span>
<span id="cb143-13"><a href="r-y-spark.html#cb143-13"></a>sp_t2&lt;-sp_pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">compute</span>(<span class="st">&quot;t2&quot;</span>)</span>
<span id="cb143-14"><a href="r-y-spark.html#cb143-14"></a><span class="co"># consultas a spark</span></span>
<span id="cb143-15"><a href="r-y-spark.html#cb143-15"></a></span>
<span id="cb143-16"><a href="r-y-spark.html#cb143-16"></a>sp_pvbol <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">group_by</span>(Departamento,Provincia) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">media_mas=</span><span class="kw">mean</span>(mas),<span class="dt">media_cc=</span><span class="kw">mean</span>(cc),<span class="kw">sd</span>(mas))</span>
<span id="cb143-17"><a href="r-y-spark.html#cb143-17"></a></span>
<span id="cb143-18"><a href="r-y-spark.html#cb143-18"></a><span class="co"># SQL show_query</span></span>
<span id="cb143-19"><a href="r-y-spark.html#cb143-19"></a>sp_pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_query</span>()</span>
<span id="cb143-20"><a href="r-y-spark.html#cb143-20"></a></span>
<span id="cb143-21"><a href="r-y-spark.html#cb143-21"></a>sp_pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Departamento) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(mas,cc) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise_all</span>(mean) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_query</span>()</span>
<span id="cb143-22"><a href="r-y-spark.html#cb143-22"></a></span>
<span id="cb143-23"><a href="r-y-spark.html#cb143-23"></a><span class="co"># spark SQL</span></span>
<span id="cb143-24"><a href="r-y-spark.html#cb143-24"></a><span class="kw">library</span>(DBI)</span>
<span id="cb143-25"><a href="r-y-spark.html#cb143-25"></a>e10&lt;-<span class="kw">dbGetQuery</span>(sc,<span class="st">&quot;Select * from elecciones limit 10&quot;</span>)</span>
<span id="cb143-26"><a href="r-y-spark.html#cb143-26"></a></span>
<span id="cb143-27"><a href="r-y-spark.html#cb143-27"></a><span class="co"># figuras </span></span>
<span id="cb143-28"><a href="r-y-spark.html#cb143-28"></a>sp_pvbol <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(cc) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">hist</span>()</span>
<span id="cb143-29"><a href="r-y-spark.html#cb143-29"></a></span>
<span id="cb143-30"><a href="r-y-spark.html#cb143-30"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb143-31"><a href="r-y-spark.html#cb143-31"></a><span class="kw">ggplot</span>(sp_pvbol,<span class="kw">aes</span>(cc))<span class="op">+</span><span class="kw">geom_histogram</span>()</span>
<span id="cb143-32"><a href="r-y-spark.html#cb143-32"></a><span class="kw">ggplot</span>(sp_pvbol,<span class="kw">aes</span>(cc,mas))<span class="op">+</span><span class="kw">geom_point</span>()</span>
<span id="cb143-33"><a href="r-y-spark.html#cb143-33"></a></span>
<span id="cb143-34"><a href="r-y-spark.html#cb143-34"></a><span class="co"># recomendación ml</span></span></code></pre></div>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="r-y-spark.html#cb144-1"></a><span class="kw">load</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">Users</span><span class="ch">\\</span><span class="st">ALVARO</span><span class="ch">\\</span><span class="st">Documents</span><span class="ch">\\</span><span class="st">GitHub</span><span class="ch">\\</span><span class="st">EST-383</span><span class="ch">\\</span><span class="st">data</span><span class="ch">\\</span><span class="st">oct20.RData&quot;</span>)</span>
<span id="cb144-2"><a href="r-y-spark.html#cb144-2"></a><span class="kw">head</span>(computo)</span>
<span id="cb144-3"><a href="r-y-spark.html#cb144-3"></a><span class="co">#filtrado</span></span>
<span id="cb144-4"><a href="r-y-spark.html#cb144-4"></a>aux&lt;-computo[computo<span class="op">$</span>País<span class="op">==</span><span class="st">&quot;Bolivia&quot;</span>,] <span class="co">#en R</span></span>
<span id="cb144-5"><a href="r-y-spark.html#cb144-5"></a>aux2&lt;-computo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(País<span class="op">==</span><span class="st">&quot;Bolivia&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="r-y-spark.html#cb145-1"></a><span class="co">#spark SQL</span></span>
<span id="cb145-2"><a href="r-y-spark.html#cb145-2"></a><span class="kw">library</span>(DBI)</span>
<span id="cb145-3"><a href="r-y-spark.html#cb145-3"></a>top10 &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(sc, <span class="st">&quot;Select * from importaciones limit 10&quot;</span>)</span>
<span id="cb145-4"><a href="r-y-spark.html#cb145-4"></a>top10</span>
<span id="cb145-5"><a href="r-y-spark.html#cb145-5"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb145-6"><a href="r-y-spark.html#cb145-6"></a>sp_importaciones <span class="op">%&gt;%</span><span class="st"> </span>tally</span>
<span id="cb145-7"><a href="r-y-spark.html#cb145-7"></a>sp_covid2 <span class="op">%&gt;%</span><span class="st"> </span>tally</span>
<span id="cb145-8"><a href="r-y-spark.html#cb145-8"></a>oct20 <span class="op">%&gt;%</span><span class="st"> </span>tally</span>
<span id="cb145-9"><a href="r-y-spark.html#cb145-9"></a>covid_cache &lt;-<span class="st"> </span>sp_covid2 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb145-10"><a href="r-y-spark.html#cb145-10"></a><span class="st">    </span><span class="kw">compute</span>(<span class="st">&quot;covid_ch&quot;</span>)</span>
<span id="cb145-11"><a href="r-y-spark.html#cb145-11"></a>covid_cache <span class="op">%&gt;%</span><span class="st"> </span>tally</span></code></pre></div>
<p>Para correr con las bases de la parte de importaciones</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="r-y-spark.html#cb146-1"></a><span class="co">#importaciones</span></span>
<span id="cb146-2"><a href="r-y-spark.html#cb146-2"></a><span class="kw">dimnames</span>(sp_importaciones)</span>
<span id="cb146-3"><a href="r-y-spark.html#cb146-3"></a></span>
<span id="cb146-4"><a href="r-y-spark.html#cb146-4"></a>sp_t1&lt;-sp_importaciones <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(GESTION) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">compute</span>(<span class="st">&quot;t1&quot;</span>)</span>
<span id="cb146-5"><a href="r-y-spark.html#cb146-5"></a></span>
<span id="cb146-6"><a href="r-y-spark.html#cb146-6"></a>aa&lt;-sp_importaciones <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(GESTION) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collect</span>()</span>
<span id="cb146-7"><a href="r-y-spark.html#cb146-7"></a>aa&lt;-sp_importaciones <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(GESTION,DESDEPTO) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collect</span>()</span>
<span id="cb146-8"><a href="r-y-spark.html#cb146-8"></a>sp_covid2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(SEXO,NEUMONIA)</span>
<span id="cb146-9"><a href="r-y-spark.html#cb146-9"></a>sp_covid2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(SEXO) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="kw">mean</span>(EDAD),<span class="dt">na.rm=</span>T)</span>
<span id="cb146-10"><a href="r-y-spark.html#cb146-10"></a></span>
<span id="cb146-11"><a href="r-y-spark.html#cb146-11"></a>ww&lt;-sp_importaciones <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(GESTION,DESDEPTO,NANDINA) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">total=</span><span class="kw">sum</span>(FOB,<span class="dt">na.rm=</span>T)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collect</span>()</span>
<span id="cb146-12"><a href="r-y-spark.html#cb146-12"></a>sp_importaciones <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">tbl</span>(GESTION)</span>
<span id="cb146-13"><a href="r-y-spark.html#cb146-13"></a></span>
<span id="cb146-14"><a href="r-y-spark.html#cb146-14"></a>oct20 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(MAS__IPSP,CC)<span class="op">%&gt;%</span><span class="st">  </span><span class="kw">summarise_all</span>(mean)</span>
<span id="cb146-15"><a href="r-y-spark.html#cb146-15"></a>oct20 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(MAS__IPSP,CC)<span class="op">%&gt;%</span><span class="st">  </span><span class="kw">summarise_all</span>(mean) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_query</span>()</span>
<span id="cb146-16"><a href="r-y-spark.html#cb146-16"></a>oct20 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">qq=</span><span class="kw">quantile</span>(CC,<span class="dt">probs=</span><span class="fl">0.5</span>))</span>
<span id="cb146-17"><a href="r-y-spark.html#cb146-17"></a>oct20 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(MAS__IPSP,CC) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ml_corr</span>()</span>
<span id="cb146-18"><a href="r-y-spark.html#cb146-18"></a></span>
<span id="cb146-19"><a href="r-y-spark.html#cb146-19"></a><span class="co">#figuras</span></span>
<span id="cb146-20"><a href="r-y-spark.html#cb146-20"></a>oct20 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(CC) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">hist</span>()</span>
<span id="cb146-21"><a href="r-y-spark.html#cb146-21"></a></span>
<span id="cb146-22"><a href="r-y-spark.html#cb146-22"></a><span class="kw">library</span>(dbplot)</span>
<span id="cb146-23"><a href="r-y-spark.html#cb146-23"></a>oct20 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dbplot_histogram</span>(CC,<span class="dt">binwidth =</span> <span class="dv">3</span>)</span>
<span id="cb146-24"><a href="r-y-spark.html#cb146-24"></a>sp_importaciones <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">dbplot_bar</span>(GESTION)</span>
<span id="cb146-25"><a href="r-y-spark.html#cb146-25"></a>oct20 <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">dbplot_raster</span>(CC,MAS__IPSP)</span>
<span id="cb146-26"><a href="r-y-spark.html#cb146-26"></a></span>
<span id="cb146-27"><a href="r-y-spark.html#cb146-27"></a>oct20 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(PaAs<span class="op">==</span><span class="st">&quot;Bolivia&quot;</span>)<span class="op">%&gt;%</span><span class="st">  </span><span class="kw">group_by</span>(Departamento) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">voto=</span><span class="kw">mean</span>(CC)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Departamento,voto))<span class="op">+</span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</span>
<span id="cb146-28"><a href="r-y-spark.html#cb146-28"></a></span>
<span id="cb146-29"><a href="r-y-spark.html#cb146-29"></a><span class="kw">ggplot</span>(oct20,<span class="kw">aes</span>(CC,MAS__IPSP))<span class="op">+</span><span class="kw">geom_point</span>()</span></code></pre></div>

<div id="refs" class="references">
<div>
<p>Allaire, JJ, Yihui Xie, Jonathan McPherson, Javier Luraschi, Kevin Ushey, Aron Atkins, Hadley Wickham, Joe Cheng, Winston Chang, and Richard Iannone. 2020. <em>Rmarkdown: Dynamic Documents for R</em>. <a href="https://CRAN.R-project.org/package=rmarkdown">https://CRAN.R-project.org/package=rmarkdown</a>.</p>
</div>
<div>
<p>R Core Team. 2019. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.</p>
</div>
<div>
<p>Xie, Yihui. 2019. <em>Knitr: A General-Purpose Package for Dynamic Report Generation in R</em>. <a href="https://CRAN.R-project.org/package=knitr">https://CRAN.R-project.org/package=knitr</a>.</p>
</div>
<div>
<p>———. 2020. <em>Bookdown: Authoring Books and Technical Documents with R Markdown</em>. <a href="https://CRAN.R-project.org/package=bookdown">https://CRAN.R-project.org/package=bookdown</a>.</p>
</div>
<div>
<p>Xie, Yihui, J. J. Allaire, and Garrett Grolemund. 2018. “How to Read This Book.” <em>Transforming Climate Finance and Green Investment with Blockchains</em>, 1. <a href="https://doi.org/10.1016/b978-0-12-814447-3.00041-0">https://doi.org/10.1016/b978-0-12-814447-3.00041-0</a>.</p>
</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="big-data-en-r.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
